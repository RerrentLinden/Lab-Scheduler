# 实验室预约平台

## 项目概述
实验室预约平台是一套帮助科研团队协调共享仪器使用的预约管理系统。本文件旨在为后续的开发与部署工作提供统一参考，整理预期功能、技术选型以及贡献者应遵循的约定。

## 核心功能模块
### 用户管理
- **注册与登录**：支持通过手机号、密码与用户名创建账号，并提供找回密码流程。
- **角色与权限**：超级管理员（同时承担设备管理员职责）拥有系统配置权限，普通用户可浏览与预约仪器。
- **个人工作台**：
  - 修改密码并查看账号元数据。
  - 展示常用仪器及典型使用时段的统计图表。
  - 维护收藏夹，实现常用仪器一键预约。

### 仪器管理
- 维护仪器元数据（照片、名称、唯一编号、类别、房间、台位、责任人）。
- 跟踪状态（可用、维护中、已退役）及其变更历史。
- 记录维护日志、下一次保养提醒以及维护联系人信息。

### 仪器预约
- 以日历视图展示每台仪器的预约情况，按时段着色。
- 预约规则：需提前 ≥30 分钟预约，取消需提前 ≥30 分钟并填写原因，单次预约最长 4 小时，最多可提前预约至次日。
- 快速筛选某一类别下当前可预约的仪器。
- 支持扫码快速预约与签到确认使用开始。

### 冲突处理与候补队列
- 若用户 15 分钟内未签到则自动释放预约，并按顺序通知候补用户。
- 使用中的会话可以申请延长时长，系统会检测后续冲突并提醒受影响用户。
- 用户可自定义通知时段后加入候补队列。

### 分析与报表
- 提供月度使用率汇总、使用频次排行与空闲时段分析。
- 保存预约历史，支持按日期范围、用户、仪器筛选并导出 Excel。
- 追踪违规行为（未到场、频繁取消、超时使用），维护影响排队优先级的信用分。

### 系统可靠性与通知
- 持久化所有预约与审计数据，支持导出 Excel，并规划自动化备份。
- 通知事件：预约成功、使用前提醒、取消更新、设备恢复可用等。

## 架构方案
系统计划采用 **基于 Node.js（Express）的单体应用**，通过轻量模板引擎（如 EJS 或 Nunjucks）渲染 HTML 页面。该方案可在保持技术栈精简的同时，以渐进增强方式配合原生 JavaScript 提供交互体验。

关键集成点：
1. **服务端渲染 HTML**：核心页面在服务端渲染，前端按需渐进增强。
2. **RESTful 接口**：后续的动态功能（如日历刷新、统计图表）可通过 JSON 接口提供。
3. **MySQL 数据库**：集中存储用户、仪器、预约、维护记录以及分析数据。
4. **容器化部署**：应用与数据库通过 Docker 进行容器化，简化多环境部署。

## 计划目录结构
随着功能实现，代码仓库将逐步演进为以下结构：
```
Lab-Scheduler/
├── backend/           # Express 应用源码（路由、服务、模板、静态资源）
├── database/          # SQL 模型、种子数据与迁移脚本
├── docker/            # Dockerfile 与 docker-compose 配置
├── docs/              # 补充文档（API 规格、设计说明）
├── scripts/           # 自动化脚本（备份、维护、报表）
└── tests/             # 自动化测试（单元、集成、端到端）
```
当前仓库仅包含文档，后续可在实现对应功能时创建上述目录。

## 开发流程
### 前置条件
- Node.js 20+ 及 npm。
- MySQL 8（本地安装或容器化实例）。
- Docker 与 Docker Compose（用于容器化流程）。

### 环境配置
1. 复制 `.env.example`（后续添加）为 `.env` 并配置：
   - `DB_HOST`、`DB_PORT`、`DB_USER`、`DB_PASSWORD`、`DB_NAME` 等数据库访问参数。
   - `SESSION_SECRET` 及其他安全相关字段。
2. 使用即将提供的迁移脚本初始化数据库。
3. 在提交后端脚手架后，于 `backend/` 中执行 `npm install` 安装依赖。

### 本地开发（规划中）
1. 启动本地或 Docker 版 MySQL。
2. 执行数据库迁移与种子数据脚本。
3. 运行 Express 开发服务器（例如 `npm run dev`），通过终端输出的地址访问 UI。
4. 在提交代码前运行代码风格检查（`npm run lint`）与测试（`npm test`）。

## Docker 与部署策略
- 通过 `docker-compose.yml` 编排 Express 应用与 MySQL 服务。
- 应用容器开放可配置的 HTTP 端口（默认 8080），MySQL 容器内部开放 3306。
- 使用持久化卷保存数据库数据与上传的资源。
- CI/CD 流水线需构建并推送版本化镜像、运行自动化测试并触发目标环境的滚动更新。

## 数据管理规范
- 长期保留所有预约与审计记录，必要时采用表分区策略进行归档。
- 定期执行数据库自动备份，并安全存储（例如每晚导出压缩备份）。
- 提供 CSV/Excel 导出接口以满足报表需求。

## 测试与质量保障
- 针对业务规则（预约限制、冲突检测、通知触发）编写单元测试。
- 构建覆盖端到端预约流程的集成测试。
- 保持一致的代码风格与格式。
- 对认证、授权与输入验证进行安全审查。

## 路线图重点
1. 搭建带有认证和会话管理的 Express 后端脚手架。
2. 实现仪器与预约的核心 CRUD 流程。
3. 构建日历与统计可视化模块。
4. 按需接入通知服务（邮件/SMS/推送）。
5. 加固部署脚本与监控体系。

## 贡献指南
- 采用 Git 分支协作（或短期特性分支），通过 Pull Request 提交代码审查。
- 随功能更新同步维护文档与配置文件。
- 使用版本化迁移脚本协调数据库结构变更。

## 许可
正式的项目许可证将在代码库成熟后确定。在此之前，所有贡献均归属于项目发起团队。
